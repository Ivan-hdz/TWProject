<app-redirect-if-not-logged></app-redirect-if-not-logged>
<app-menu></app-menu>
<app-access-denied-page [authLevelRequired]="0">
    <div>
      <div>
        <div [hidden]="myAlert.hidden">
          <ngb-alert type="{{myAlert.type}}" [dismissible]="true" (close)="myAlert.hidden = true" >
            <strong>{{myAlert.title}} </strong> {{myAlert.body}}
          </ngb-alert>
        </div>
        <br>
        <div class="padding-left-rigth" >
          <div class="row">
            <div class="col">
              <h2 >Usuarios registrados</h2>
            </div>
            <div class="col text-lg-right">
              <button mat-button data-toggle="collapse" data-target="#nuevo" color="primary">Agregar usuario ...</button>
            </div>
          </div>
          <form (submit)="newUser(nUsername, nNickname, nPassword, nAuthLevel)" id="nuevo" class="collapse">
            <div class="row">
              <div class="col">
                <mat-form-field>
                 <input type="text" required matInput #nUsername placeholder="Nombre de usuario" />
                </mat-form-field>
              </div>
              <div class="col">
                <mat-form-field>
                  <input matInput required type="text" #nNickname placeholder="Nombre a mostrar (nickname)" />
                </mat-form-field>
              </div>
              <div class="col">
                <mat-form-field>
                <input matInput required type="password" #nPassword class="form-control" placeholder="Contraseña" />
                </mat-form-field>
              </div>
              <div class="col">
                <mat-form-field>
                <mat-select required #nAuthLevel placeholder="Seleccione un rol para el usuario">
                  <mat-option value="0">Administrador</mat-option>
                  <mat-option value="1">Profesor</mat-option>
                  <mat-option value="2">Alumno</mat-option>
                </mat-select>
                </mat-form-field>
              </div>
              <div class="col text-lg-right">
                <button mat-button color="accent">Crear nuevo usuario</button>
              </div>
            </div>
          </form>
          <div class="row">
            <div class="col">
              <h3>Buscar: </h3>
            </div>
            <div class="col">
              <mat-form-field>
              <input matInput placeholder="Algo" type="text" #searchVal (keyup)="search(searchVal.value)" />
              </mat-form-field>
            </div>
            <div class="col text-right">
              <h3> por: </h3>
            </div>
            <div class="col">
              <mat-form-field>
              <mat-select  #searchType (change)="sType = searchType.value" value="0">
                <mat-option value="0">Nombre de usuario</mat-option>
                <mat-option value="1">Nickname</mat-option>
              </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>
        <table class="table">
          <thead class="thead-dark text-center">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Nombre de usuario</th>
            <th scope="col">Nombre a mostrar</th>
            <th scope="col">Contraseña</th>
            <th scope="col">Tipo de usuario</th>
            <th scope="col" colspan="2">Acciones</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let usr of (registrdUsers$ | async)">
            <th scope="row">{{usr.refNum}}</th>
            <td><input type="text" class="form-control" value="{{usr.username}}" disabled /></td>
            <td><input [name]="usr.username == 'Administrador' ? '' : usr.username" type="text" class="form-control" value="{{usr.nickname}}" disabled /></td>
            <td><input [name]="usr.username" type="password" class="form-control" value="{{usr.password}}" disabled /></td>
            <td>
              <select [name]="usr.username == 'Administrador' ? '' : usr.username" #auL (change)="usr.authLevel = auL.value" class="form-control" disabled>
                <option [selected]="usr.authLevel == 0" value="0">Administrador</option>
                <option [selected]="usr.authLevel == 1" value="1">Profesor</option>
                <option [selected]="usr.authLevel == 2" value="2">Alumno</option>
              </select>
            </td>
            <td><button [id]="usr.username" class="btn-link btn"  (click)="edit(usr)">{{usr.actualBtnLabel}}</button></td>
            <td><button class="btn-link btn" [disabled]="usr.username == 'Administrador'" (click)="deleteUsr(usr)">Eliminar usuario</button></td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
</app-access-denied-page>

